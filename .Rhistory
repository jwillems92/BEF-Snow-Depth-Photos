# Extract EXIF data
exif_dat <- read_exif(image_files, recursive = FALSE)
exif_dat
# Separate Date & Time columns
file_dat <- exif_dat %>%
select(SourceFile, FileModifyDate) %>%
separate(col = "FileModifyDate",           # Split col into Date & Time cols
into = c("Date", "Time"),
sep = " ") %>%
separate(col = "Date",                     # Split Date col into M, D, Y cols
into = c("Year", "Month", "Day"),
sep = ":") %>%
separate(col = "Time",                     # Split time col
into = c("Time", NA),
sep = "-") %>%
mutate(Date = mdy(paste(Month, Day, Year, sep="/"))) # Created Date col w/ correct formatting
# Create a vector of all unique dates
date_vec <- file_dat %>%
group_by(Date) %>%                 # Likely a better way to do this...
summarise(Time = first(Time)) %>%  # This summarise is just a placeholder for getting the
ungroup() %>%                      # vector of unique dates
pull(Date)
# Get sunrise times for all dates
sunrise_times <- getSunlightTimes(date = date_vec, lat = 44.0639, lon = -71.2874,
keep = c("sunrise"),
tz = "America/New_York") %>%
select(date, sunrise)
# Join sunrise times back to main exif data frame
joined_df <- left_join(file_dat, sunrise_times, by = c("Date" = "date"))
## Combine Time and Date columns into a POSIXct datetime column
## Find the difftime between time photo was taken and sunrise time
## Filter for difftime >=1 to eliminate photos taken when too dark to read stake (could tweak this)
final_df <- joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, Time)
# write.csv(file = "BEF Snow 2020 Subsetted.csv", final_df, row.names = FALSE)
final_df
joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 0.5) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, Time)
knitr::opts_chunk$set(echo = TRUE)
library(exifr)
library(tidyverse)
library(suncalc)
library(lubridate)
# Set WD to main folder containing sub-folders for each year & month
# Pull in list of all images
image_files <- list.files(path = "Snow Photos",
pattern = "*.jpg",
recursive = TRUE,
full.names = TRUE)
image_files
# Extract EXIF data
exif_dat <- read_exif(image_files,
recursive = FALSE,
tags = c("SourceFile", "FileModifyDate"))
# Separate Date & Time columns
file_dat <- exif_dat %>%
separate(col = "FileModifyDate",           # Split col into Date & Time cols
into = c("Date", "Time"),
sep = " ") %>%
separate(col = "Date",                     # Split Date col into M, D, Y cols
into = c("Year", "Month", "Day"),
sep = ":") %>%
separate(col = "Time",                     # Split time col
into = c("Time", NA),
sep = "-") %>%
mutate(Date = mdy(paste(Month, Day, Year, sep="/"))) # Created Date col w/ correct formatting
# Create a vector of all unique dates
date_vec <- file_dat %>%
group_by(Date) %>%                 # Likely a better way to do this...
summarise(Time = first(Time)) %>%  # This summarise is just a placeholder for getting the
ungroup() %>%                      # vector of unique dates
pull(Date)
# Get sunrise times for all dates
sunrise_times <- getSunlightTimes(date = date_vec, lat = 44.0639, lon = -71.2874,
keep = c("sunrise"),
tz = "America/New_York") %>%
select(date, sunrise)
# Join sunrise times back to main exif data frame
joined_df <- left_join(file_dat, sunrise_times, by = c("Date" = "date"))
## Combine Time and Date columns into a POSIXct datetime column
## Find the difftime between time photo was taken and sunrise time
## Filter for difftime >=1 to eliminate photos taken when too dark to read stake (could tweak this)
final_df <- joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, Time)
# write.csv(file = "BEF Snow 2020 Subsetted.csv", final_df, row.names = FALSE)
final_df
# Create vector of subsetted file names
subset_files <- final_df %>% pull(SourceFile)
subset_files
# Create vector of subsetted file names
subset_files <- final_df %>% pull(SourceFile)
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
jpeg(filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
library(imager)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
jpeg(filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
# Create vector of subsetted file names
subset_files <- final_df %>% pull(SourceFile)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
# jpeg(filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
subset_files
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
jpeg(temp,
filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
# Create vector of subsetted file names
subset_files <- final_df %>% pull(SourceFile)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
jpeg(temp)
}
# Set WD to main folder containing sub-folders for each year & month
# Pull in list of all images
image_files <- list.files(path = "Snow Photos",
pattern = "*.jpg",
recursive = TRUE,
full.names = TRUE)
# Extract EXIF data
exif_dat <- read_exif(image_files,
recursive = FALSE)
exif_dat
# Separate Date & Time columns
file_dat <- exif_dat %>%
select(FileName, FileModifyDate) %>%
separate(col = "FileModifyDate",           # Split col into Date & Time cols
into = c("Date", "Time"),
sep = " ") %>%
separate(col = "Date",                     # Split Date col into M, D, Y cols
into = c("Year", "Month", "Day"),
sep = ":") %>%
separate(col = "Time",                     # Split time col
into = c("Time", NA),
sep = "-") %>%
mutate(Date = mdy(paste(Month, Day, Year, sep="/"))) # Created Date col w/ correct formatting
# Create a vector of all unique dates
date_vec <- file_dat %>%
group_by(Date) %>%                 # Likely a better way to do this...
summarise(Time = first(Time)) %>%  # This summarise is just a placeholder for getting the
ungroup() %>%                      # vector of unique dates
pull(Date)
# Get sunrise times for all dates
sunrise_times <- getSunlightTimes(date = date_vec, lat = 44.0639, lon = -71.2874,
keep = c("sunrise"),
tz = "America/New_York") %>%
select(date, sunrise)
# Join sunrise times back to main exif data frame
joined_df <- left_join(file_dat, sunrise_times, by = c("Date" = "date"))
## Combine Time and Date columns into a POSIXct datetime column
## Find the difftime between time photo was taken and sunrise time
## Filter for difftime >=1 to eliminate photos taken when too dark to read stake (could tweak this)
final_df <- joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, Time)
joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(FileName, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(FileName = first(FileName),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(FileName, Year, Month, Day, Time)
final_df <- joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(FileName, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(FileName = first(FileName),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(FileName, Year, Month, Day, Time)
# Create vector of subsetted file names
subset_files <- final_df %>% pull(FileName)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
# Create vector of subsetted file names
subset_files <- final_df %>% pull(FileName)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/Test/", index))
}
knitr::opts_chunk$set(echo = TRUE)
library(exifr)
library(tidyverse)
library(suncalc)
library(lubridate)
library(imager)
# Set WD to main folder containing sub-folders for each year & month
# Pull in list of all images
image_files <- list.files(path = "Snow Photos",
pattern = "*.jpg",
recursive = TRUE,
full.names = TRUE)
# Extract EXIF data
exif_dat <- read_exif(image_files,
recursive = FALSE,
tags = c("SourceFile", "FileModifyDate"))
# Separate Date & Time columns
file_dat <- exif_dat %>%
separate(col = "FileModifyDate",           # Split col into Date & Time cols
into = c("Date", "Time"),
sep = " ") %>%
separate(col = "Date",                     # Split Date col into M, D, Y cols
into = c("Year", "Month", "Day"),
sep = ":") %>%
separate(col = "Time",                     # Split time col
into = c("Time", NA),
sep = "-") %>%
mutate(Date = mdy(paste(Month, Day, Year, sep="/"))) # Created Date col w/ correct formatting
# Create a vector of all unique dates
date_vec <- file_dat %>%
group_by(Date) %>%                 # Likely a better way to do this...
summarise(Time = first(Time)) %>%  # This summarise is just a placeholder for getting the
ungroup() %>%                      # vector of unique dates
pull(Date)
# Get sunrise times for all dates
sunrise_times <- getSunlightTimes(date = date_vec, lat = 44.0639, lon = -71.2874,
keep = c("sunrise"),
tz = "America/New_York") %>%
select(date, sunrise)
# Join sunrise times back to main exif data frame
joined_df <- left_join(file_dat, sunrise_times, by = c("Date" = "date"))
## Combine Time and Date columns into a POSIXct datetime column
## Find the difftime between time photo was taken and sunrise time
## Filter for difftime >=1 to eliminate photos taken when too dark to read stake (could tweak this)
final_df <- joined_df %>%
# Create datetime column for when photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time), format="%Y-%m-%d %H:%M:%S")) %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, Time) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
Time = first(Time)) %>%             # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, Time)
# write.csv(file = "BEF Snow 2020 Subsetted.csv", final_df, row.names = FALSE)
final_df
subset_files
# Create vector of subsetted file names
subset_files <- final_df %>% pull(SourceFile)
subset_files
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("TEST/", index))
}
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("TEST", index))
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("TEST", index))
}
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
temp %>%
jpeg(filename = paste0("TEST/", index))
}
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
jpeg(filename = paste0("TEST/", index))
}
library(jpeg)
for(index in subset_files){
# Define the file path for original photos to sort through
fpath <- paste0("C:/Users/jswil/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos/", index)
# Read each file from the subset vector
temp <- load.image(fpath)
# Save as new file in new folder
writeJPEG(temp)
}
setwd("~/Documents/R/PROJECTS/PhD/BEF Snow Depth Photos")
library(tidyverse)
library(suncalc)
library(lubridate)
library(imager)
# Pull in list of all images
image_files <- list.files(path = "Snow Photos",
pattern = "*.jpg",
recursive = TRUE,
full.names = TRUE)
# Convert vector of image files to dataframe for manipulation
image_files <- as.data.frame(image_files) %>%
rename("SourceFile" = "image_files")
image_files
file_dat <- image_files %>%
#Duplicate column for extracting dates and times
mutate(DateTime = SourceFile) %>%
# Remove file path and site ID portion of file names
mutate(DateTime = str_remove(DateTime,
pattern = "Snow Photos/\\d+/\\d+/NEON.D01.BART.DP1.00042_")) %>%
# Split the DateTime column out into individual components
separate(DateTime,
into = c("Year", "Month", "Day", "Time"),
sep = "_") %>%
# Remove the .jpg extension from each file name
mutate(Time = str_remove(Time,
pattern = ".jpg")) %>%
# Format the time column correctly
mutate(Time = paste0(substr(Time,1,2),":",substr(Time,3,4),":", substr(Time,5,6))) %>%
# Create a correctly formatted Date column
mutate(Date = mdy(paste(Month, Day, Year, sep = "/"))) %>%
# Create a Datetime column for time photo was taken
mutate(PhotoTime = as.POSIXct(paste(Date, Time),
format="%Y-%m-%d %H:%M:%S")) %>%
# Select only column of interest
select(SourceFile, Year, Month, Day, PhotoTime, Date)
# Create a vector of all unique dates
date_vec <- file_dat %>%
group_by(Date) %>%                           # Likely a better way to do this...
summarise(PhotoTime = first(PhotoTime)) %>%  # This summarise is just a placeholder for getting the
ungroup() %>%                                # vector of unique dates
pull(Date)
# Get sunrise times for all dates
sunrise_times <- getSunlightTimes(date = date_vec, lat = 44.0639, lon = -71.2874,
keep = c("sunrise"),
tz = "America/New_York") %>%
select(date, sunrise)
# Join sunrise times back to main exif data frame
joined_df <- left_join(file_dat, sunrise_times, by = c("Date" = "date"))
final_df <- joined_df %>%
# Calculate time difference between when photo was taken and sunrise time of that day
mutate(TimeAfterSunrise = as.numeric(difftime(PhotoTime, sunrise, units="hours"))) %>%
# Filter for photos taken >= 1 hour after sunrise
filter(TimeAfterSunrise >= 1) %>%
# Select only columns needed for final spreadsheet
select(SourceFile, Date, Year, Month, Day, PhotoTime) %>%
# Group by date to get only 1 photo per day
group_by(Date) %>%
summarise(SourceFile = first(SourceFile),
PhotoTime = first(PhotoTime)) %>%     # This should give us just the first photo of the day
# Break Date column back up into individual components for easier sorting
mutate(Year = year(Date),
Month = month(Date),
Day = day(Date)) %>%
# Reselect final columns wanted in order
select(SourceFile, Year, Month, Day, PhotoTime) %>%
# Remove date from PhotoTime column
separate(PhotoTime,
into = c(NA, "Time"),
sep = " ")
# Save output as a csv file
write.csv(file = "BEF Snow 2020 Subsetted.csv", final_df, row.names = FALSE)
final_df
# Clean up output and save as a csv file
final_df %>%
str_remove(SourceFile, pattern = "Snow Photos/\\d+/\\d+/") %>%
write.csv(file = "BEF Snow 2020 Subsetted.csv", final_df, row.names = FALSE)
final_df
# Clean up output and save as a csv file
final_df %>%
str_remove(SourceFile, pattern = "Snow Photos/\\d+/\\d+/") %>%
write.csv(file = "BEF Snow 2020 Subsetted.csv", row.names = FALSE)
final_df
# Clean up output and save as a csv file
final_df %>%
mutate(SourceFile = str_remove(SourceFile, pattern = "Snow Photos/\\d+/\\d+/")) %>%
write.csv(file = "BEF Snow 2020 Subsetted.csv", row.names = FALSE)
